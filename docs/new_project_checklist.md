# Soul New Project Generator - Implementation Checklist

This checklist outlines the steps to implement the `soul new project` generator based on the agreed architecture.

## Phase 1: Setup `soul new project` Command

- [ ] Create directory: `tools/soul/cmd/new/`
- [ ] Create directory: `tools/soul/cmd/new/templates/`
- [ ] Create `tools/soul/cmd/new/cmd.go` defining the top-level `new` command using Cobra.
- [ ] Create `tools/soul/cmd/new/project.go` defining the `project` subcommand using Cobra.
  - [ ] Add argument for `<project_name>`.
  * [ ] Add basic flags (e.g., `--api <path_to_api_spec>`, `--dir <output_directory>`).
- [ ] Register the `new` command in `tools/soul/cmd/root.go`.
- [ ] Create a basic builder structure (`tools/soul/cmd/new/builder.go` or similar) to manage generation context and steps.
- [ ] Copy essential base template files (e.g., `main.go.tpl`, `Makefile.tpl`, `Dockerfile.tpl`, `gitignore.tpl`, basic config `.yaml.tpl`) from `tools/soul/cmd/saas/templates/` to `tools/soul/cmd/new/templates/`, adapting paths and module names as needed.

## Phase 2: Implement Core Architecture Generation

- **Manual Models:**
  - [ ] Create `tools/soul/cmd/new/templates/app/models/` directory.
  - [ ] Add core Go model struct files (e.g., `user.go`, `team.go`) to the models template directory.
  - [ ] Ensure the builder copies these files to the target project's `models/` directory.
- **`sqlc` Integration:**
  - [ ] Add `sqlc.yaml.tpl` to `tools/soul/cmd/new/templates/`. Configure it for standard paths (e.g., `db/queries/`, `db/sqlc/`, `models/`).
  - [ ] Create `tools/soul/cmd/new/templates/db/queries/` directory.
  - [ ] Add base `.sql` files (e.g., `schema.sql` with `CREATE TABLE`, `user.sql`, `team.sql` with common queries) to the queries template directory.
  * [ ] Add logic to the `new project` builder/command handler to run `sqlc generate` after scaffolding.
- **API Spec Parsing:**
  - [ ] Ensure the `new project` builder correctly parses the provided `.api` spec file into a `spec.SiteSpec` object. Reuse existing parsing logic if possible.
- **Generator Logic (Backend):**
  - [ ] Adapt/create generator functions (e.g., `buildHandlers`, `buildLogic`, `buildRoutes`, `buildSvc`) specifically for the `new project` command.
  - [ ] Adapt/create Go templates (`*.go.tpl`) for handlers, logic, routes, svc within `tools/soul/cmd/new/templates/`.
  - [ ] Ensure generated logic stubs import and use functions generated by `sqlc` (from `db/sqlc/`).
  - [ ] Ensure generated routes correctly handle API (JSON), static (`get static`/`get static-embed`), and dynamic Templ view routes based on the `.api` spec.
- **TypeScript Client Generation:**
  - [ ] Create new generator logic (e.g., `buildTsClient.go`) within `tools/soul/cmd/new/`.
  - [ ] Implement parsing of `spec.SiteSpec` focusing on API types and routes.
  - [ ] Create Go templates (`*.ts.tpl`) for generating `models.ts`, `apiClient.ts`, and `endpoints.ts`.
  - [ ] Integrate into the `new project` builder to output the client library to `clients/ts/` (or similar) in the target project.

## Phase 3: Refine & Document

- [ ] **Verify Templates:** Thoroughly test the generation process and ensure all templates (`handler.go.tpl`, etc.) produce correct, working code for all supported route types (API, Static, Templ View).
- [ ] **Authentication:** Review and refine generated JWT middleware and login logic to robustly support Cookie and Bearer token methods. Ensure CORS is configured appropriately.
- [ ] **Error Handling:** Review error handling in generated handlers, especially for Templ view rendering.
- [ ] **Update Documentation:**
  - [ ] Create/update documentation for the `soul new project` command.
  - [ ] Update `docs/llm_guide.md` to reflect the new command, the `sqlc` workflow, manual models, hybrid serving capabilities, and the TypeScript client generation.
  - [ ] Update project READMEs generated by the template.
- [ ] **Testing:** Add tests for the new generator logic.
